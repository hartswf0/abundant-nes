<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>venn‑32 · Single Vertical Stack (Mobile ISO)</title>
<style>
  :root{
    --bg:#070a09; --ink:#eaf2ec; --muted:#aab5ae;
    --ui:#21ff86; --amber:#ffdca8; --orange:#ffb167; --cyan:#7de3ff; --neutral:#b8c4bd;
    --r:14px; --glow:.7;
    --pitch: 35deg;      /* iso tilt */
    --yaw:   30deg;      /* slight yaw so edges read */
    --camZ: -880px;      /* camera distance */
    --gapZ: 24px;        /* spacing along Z */
    --scale: 1;          /* world scale for device fit */
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:radial-gradient(1400px 780px at 10% -10%,#0e1613 0%,#0a0d0f 45%,#07090a 100%);color:var(--ink);font:600 14px/1.45 system-ui,-apple-system,Segoe UI,Inter,Roboto,"Helvetica Neue",Arial;-webkit-tap-highlight-color:transparent}

  header{position:sticky;top:0;z-index:90;backdrop-filter:saturate(120%) blur(8px);background:rgba(8,12,11,.78);border-bottom:1px solid #12231c}
  .bar{display:flex;align-items:center;justify-content:space-between;padding:.5rem .8rem}
  .brand{font-weight:900;letter-spacing:.2px;font-size:13px;opacity:.9}
  .hint{opacity:.65;font:800 10px/1 ui-monospace,Menlo,monospace}

  main{height:100dvh;position:relative;overflow:hidden}
  .stageWrap{position:absolute;inset:0;perspective:1100px;touch-action:none}
  .stage{position:absolute;left:50%;top:50%;transform-style:preserve-3d;will-change:transform;
    transform:translate3d(-50%,-50%,var(--camZ)) rotateX(var(--pitch)) rotateY(var(--yaw)) scale(var(--scale));}

  /* ===== Single vertical stack ===== */
  .stackObj{position:absolute;transform-style:preserve-3d;left:0;right:0;margin:auto;width:0;height:0;
    /* rotate stack 90deg so it grows vertically. We'll counter-rotate labels */
    transform:rotateZ(90deg);
  }
  .spine{position:absolute;left:-12px;top:-4px;height:220px;width:10px;border-radius:8px;background:#0e1714;border:1px solid #1b3328;box-shadow:inset -2px 0 0 rgba(255,255,255,.04)}
  .cap{position:absolute;top:-20px;left:-6px;padding:.26rem .52rem;border-radius:10px;border:1px solid #1b352a;background:#0d1613;font:900 11px/1 ui-monospace,Menlo,monospace;color:#b8c4bd;transform:translateZ(60px) rotateZ(-90deg)}
  .count{opacity:.8;margin-left:.45rem}

  .layer{position:absolute;width:260px;height:150px;border-radius:var(--r);background:linear-gradient(180deg,#0f1513,#091110);border:1px solid #132219;overflow:hidden;transform-style:preserve-3d;cursor:pointer;will-change:transform,filter}
  .layer::after{content:"";position:absolute;inset:-30%;filter:blur(calc(18px * var(--glow)));opacity:.5;pointer-events:none}
  .g::after{background:radial-gradient(40% 35% at 50% 40%,rgba(33,255,134,.18),transparent),radial-gradient(65% 55% at 50% 60%,rgba(33,255,134,.12),transparent)}
  .a::after{background:radial-gradient(40% 35% at 50% 40%,rgba(255,220,168,.20),transparent),radial-gradient(65% 55% at 50% 60%,rgba(255,210,140,.14),transparent)}
  .o::after{background:radial-gradient(40% 35% at 50% 40%,rgba(255,177,103,.20),transparent),radial-gradient(65% 55% at 50% 60%,rgba(255,150,80,.16),transparent)}
  .c::after{background:radial-gradient(40% 35% at 50% 40%,rgba(125,227,255,.22),transparent),radial-gradient(65% 55% at 50% 60%,rgba(110,210,250,.16),transparent)}
  .n::after{background:radial-gradient(40% 35% at 50% 40%,rgba(184,196,189,.22),transparent),radial-gradient(65% 55% at 50% 60%,rgba(160,170,166,.16),transparent)}

  .layer .title{position:absolute;left:10px;bottom:10px;font-weight:900;font-size:12px;letter-spacing:.2px;transform:translateZ(30px) rotateZ(-90deg)}
  .layer .sub{position:absolute;left:10px;bottom:30px;font:800 10px/1 ui-monospace,Menlo,monospace;color:#aab5ae;opacity:.9;transform:translateZ(22px) rotateZ(-90deg)}
  .layer .tag{position:absolute;top:8px;right:8px;padding:.16rem .46rem;border-radius:999px;border:1px solid #1b352a;background:#0d1613;font:900 10px/1 ui-monospace,Menlo,monospace;color:#b8c4bd;transform:translateZ(30px) rotateZ(-90deg)}

  .layer.active{outline:1px solid #214233}

  /* ===== Big touch zones for previous/next ===== */
  .zones{position:fixed;inset:0;pointer-events:none;z-index:70}
  .zone{position:absolute;left:0;right:0;height:34%;pointer-events:auto}
  .zone.top{top:0}
  .zone.bottom{bottom:0}

  /* ===== Fixed Preview Dock ===== */
  .previewDock{position:fixed;left:50%;transform:translateX(-50%);bottom:calc(env(safe-area-inset-bottom,0) + 8px);width:min(1100px,96vw);height:58vh;border-radius:14px;overflow:hidden;border:1px solid #21362c;background:linear-gradient(180deg,#0e1714,#0a1210);box-shadow:0 24px 70px rgba(0,0,0,.45);display:none;z-index:95}
  .previewDock.open{display:block}
  .previewDock header{display:flex;align-items:center;gap:.6rem;padding:.55rem .75rem;border-bottom:1px solid #1b2c23;background:#0f1915}
  .previewDock .ttl{font-weight:800;font-size:12px}
  .previewDock .spacer{flex:1}
  .previewDock .btn{appearance:none;border:1px solid #1b352a;background:#0d1613;color:var(--ink);padding:.38rem .6rem;border-radius:10px;cursor:pointer}
  .previewDock iframe{display:block;width:100%;height:calc(100% - 42px);border:0;background:#000}

  /* ===== Base scrub (visible when dock open) ===== */
  .baseScrub{position:fixed;left:50%;transform:translateX(-50%);bottom:calc(env(safe-area-inset-bottom,0) + 60px);z-index:92;display:none;align-items:center;gap:.6rem;background:#0d1613;border:1px solid #163026;border-radius:12px;padding:.5rem .8rem}
  .baseScrub.open{display:flex}
  .baseScrub input{width:min(760px,78vw)}
  .baseScrub .info{font:900 11px/1 ui-monospace,Menlo,monospace;color:#b6c1ba;min-width:140px;text-align:center}
  .pbtn{min-width:60px;height:46px;border-radius:12px;border:1px solid #1b352a;background:#0d1613;color:var(--ink);font-weight:900}

  /* Quick site button (top-right) */
  .site{position:fixed;right:.6rem;top:.6rem;z-index:96}
  .site a{display:grid;place-items:center;width:44px;height:44px;border-radius:12px;border:1px solid #1b352a;background:#0d1613}
  .site svg{width:20px;height:20px}
</style>
</head>
<body>
<header>
  <div class="bar">
    <div class="brand">V32 · Vertical Stack</div>
    <div class="hint">tap layer → preview · swipe/top/bottom = prev/next · slider scrubs</div>
  </div>
</header>

<main>
  <div class="stageWrap" id="stageWrap">
    <div class="stage" id="stage">
      <div class="stackObj" id="oneStack">
        <div class="spine"></div>
        <div class="cap">ALL<span class="count" id="capCount"></span></div>
        <!-- layers injected here -->
      </div>
    </div>
  </div>
</main>

<!-- Giant top/bottom tap zones for prev/next -->
<div class="zones" aria-hidden="true">
  <div id="zoneTop" class="zone top"></div>
  <div id="zoneBottom" class="zone bottom"></div>
</div>

<div class="site">
  <a href="https://hartswf0.github.io/venn-32/" target="_blank" rel="noopener" title="Open site">
    <svg viewBox="0 0 24 24" fill="none" stroke="#9fd9c3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><path d="m15 3 6 6"/><path d="M21 3v6h-6"/></svg>
  </a>
</div>

<section id="dock" class="previewDock" aria-label="Preview" aria-hidden="true">
  <header>
    <div id="dockTitle" class="ttl"></div>
    <div class="spacer"></div>
    <a id="dockOpen" class="btn" target="_blank" rel="noopener">Open</a>
    <button id="dockClose" class="btn" aria-label="Close">Close</button>
  </header>
  <iframe id="dockFrame" sandbox="allow-scripts allow-forms allow-same-origin allow-pointer-lock" referrerpolicy="no-referrer"></iframe>
</section>

<div id="baseScrub" class="baseScrub" aria-label="Layer Scrub">
  <button id="prevBtn" class="pbtn" title="Prev">‹</button>
  <span class="info" id="scrubInfo">—</span>
  <input id="stackRange" type="range" min="0" max="0" step="1" value="0"/>
  <button id="nextBtn" class="pbtn" title="Next">›</button>
</div>

<script>
// ===== Data -> single vertical stack =====
const DATA={families:[
  {id:'general',color:'n',items:[
    {title:'README',file:'README.md'},
    {title:'Index',file:'index.html'},
    {title:'RHM visible layers (data)',file:'RHM_visible_layers.json'}]},
  {id:'rhm',color:'g',items:[
    {title:'RHM · 32 Layer Instrument',file:'rhm_32_layer_instrument.html'},
    {title:'RHM · Cards on Face',file:'rhm_cards_on_face.html'},
    {title:'RHM · Cards on Face v3',file:'rhm_cards_on_face_v3.html'},
    {title:'RHM · Cards on Face v4',file:'rhm_cards_on_face_v4.html'},
    {title:'RHM · Cards on Face v4a',file:'rhm_cards_on_face_v4a.html'},
    {title:'RHM · Cards on Face v5',file:'rhm_cards_on_face_v5.html'},
    {title:'RHM · Deck Overlap',file:'rhm_deck_overlap.html'},
    {title:'RHM · DOM v7b',file:'rhm_dom_v7b.html'},
    {title:'RHM · DOM v7c (mobile)',file:'rhm_dom_v7c_mobile.html'},
    {title:'RHM · DOM v7d (mobile pro)',file:'rhm_dom_v7d_mobile_pro.html'},
    {title:'RHM · DOM v7e (mobile cards)',file:'rhm_dom_v7e_mobile_cards.html'},
    {title:'RHM · DOM v7f (fix stacks colors overlay)',file:'rhm_dom_v7f_fix_stacks_colors_overlay.html'},
    {title:'RHM · DOM v7g (auto fit)',file:'rhm_dom_v7g_auto_fit.html'},
    {title:'RHM · DOM v7h (read guaranteed)',file:'rhm_dom_v7h_read_guaranteed.html'},
    {title:'RHM · Faces Reader (orig)',file:'rhm_faces_reader.html'},
    {title:'RHM · Faces Reader (1)',file:'rhm_faces_reader (1).html'},
    {title:'RHM · Faces Reader v2',file:'rhm_faces_reader_v2.html'},
    {title:'RHM · Post-its (orig)',file:'rhm_postits.html'},
    {title:'RHM · Post-its (1)',file:'rhm_postits (1).html'},
    {title:'RHM · Three v9',file:'rhm_three_v9.html'},
    {title:'RHM · Ultralite v8',file:'rhm_ultralite_v8.html'}]},
  {id:'volumetric',color:'a',items:[
    {title:'Volumetric · Cube Stacks Overlap · Nexus (Gully)',file:'volumetric_cube_stacks_overlap_nexus_gully_edition.html'},
    {title:'Volumetric · Cube Stacks Overlap · Nexus (Gully) (1)',file:'volumetric_cube_stacks_overlap_nexus_gully_edition (1).html'},
    {title:'Volumetric · Media Nexus · Unthinkable Applied',file:'volumetric_media_nexus_unthinkable_applied.html'},
    {title:'Volumetric · Media Nexus · Unthinkable Applied (1)',file:'volumetric_media_nexus_unthinkable_applied (1).html'},
    {title:'Volumetric · Media Nexus · Unthinkable Applied (2)',file:'volumetric_media_nexus_unthinkable_applied (2).html'},
    {title:'Volumetric · Media Nexus · Unthinkable Applied (3)',file:'volumetric_media_nexus_unthinkable_applied (3).html'},
    {title:'Volumetric · Media Nexus · Unthinkable Applied (4)',file:'volumetric_media_nexus_unthinkable_applied (4).html'},
    {title:'Volumetric · Venn Cubes · Mobile Draggable Dock',file:'volumetric_venn_cubes_mobile_draggable_dock.html'},
    {title:'Volumetric · Venn Cubes · Mobile Draggable Dock (1)',file:'volumetric_venn_cubes_mobile_draggable_dock (1).html'},
    {title:'Volumetric · Venn Cubes · Mobile Draggable Dock (2)',file:'volumetric_venn_cubes_mobile_draggable_dock (2).html'},
    {title:'Volumetric · Venn Cubes · Mobile Draggable Dock (3)',file:'volumetric_venn_cubes_mobile_draggable_dock (3).html'},
    {title:'Volumetric · Venn Cubes · Mobile Draggable Dock (4)',file:'volumetric_venn_cubes_mobile_draggable_dock (4).html'},
    {title:'Volumetric · Venn Cubes · Mobile Draggable Dock (5)',file:'volumetric_venn_cubes_mobile_draggable_dock (5).html'},
    {title:'Volumetric · Venn Cubes · Mobile Draggable Dock (6)',file:'volumetric_venn_cubes_mobile_draggable_dock (6).html'},
    {title:'Volumetric · Venn Cubes · Mobile Draggable Dock (7)',file:'volumetric_venn_cubes_mobile_draggable_dock (7).html'},
    {title:'Volumetric · Venn Cubes · Mobile Draggable Dock (8)',file:'volumetric_venn_cubes_mobile_draggable_dock (8).html'},
    {title:'Volumetric · Venn Cubes · Mobile Draggable Dock (9)',file:'volumetric_venn_cubes_mobile_draggable_dock (9).html'},
    {title:'Volumetric · Venn Cubes · Mobile Draggable Dock (10)',file:'volumetric_venn_cubes_mobile_draggable_dock (10).html'},
    {title:'Volumetric · Venn Cubes · Mobile Draggable Dock (11)',file:'volumetric_venn_cubes_mobile_draggable_dock (11).html'},
    {title:'Volumetric · Venn Cubes · Mobile Draggable Dock (12)',file:'volumetric_venn_cubes_mobile_draggable_dock (12).html'},
    {title:'Volumetric · Venn Cubes · Mobile Draggable Dock (13)',file:'volumetric_venn_cubes_mobile_draggable_dock (13).html'}]},
  {id:'vol_media',color:'o',items:[
    {title:'VOL Media Decks v6',file:'vol_media_decks_v6.html'},
    {title:'VOL Media Decks v7',file:'vol_media_decks_v7.html'},
    {title:'VOL Media Decks v5 · Canvas Only Data Stacks',file:'vol_media_decks_v_5_canvas_only_data_stacks.html'},
    {title:'VOL Media Decks v5 · Canvas Only Data Stacks (1)',file:'vol_media_decks_v_5_canvas_only_data_stacks (1).html'},
    {title:'VOL Media Decks v5 · Canvas Only Data Stacks (2)',file:'vol_media_decks_v_5_canvas_only_data_stacks (2).html'},
    {title:'VOL Media Decks v5 · Canvas Only Data Stacks (3)',file:'vol_media_decks_v_5_canvas_only_data_stacks (3).html'}]},
  {id:'stack_index',color:'c',items:[
    {title:'Stack Index · Minimal Preview',file:'stack_index_minimal_preview_single_file_html.html'},
    {title:'Stack Index · Minimal Preview (1)',file:'stack_index_minimal_preview_single_file_html (1).html'},
    {title:'Stack Index · Minimal Preview (2)',file:'stack_index_minimal_preview_single_file_html (2).html'},
    {title:'Stack Index · Minimal Preview (3)',file:'stack_index_minimal_preview_single_file_html (3).html'},
    {title:'Stack Index · Minimal Preview (4)',file:'stack_index_minimal_preview_single_file_html (4).html'},
    {title:'Stack Index · Minimal Preview (5)',file:'stack_index_minimal_preview_single_file_html (5).html'}]}
]};

const PAGES_BASE='https://hartswf0.github.io/venn-32/';
const SIMPLE='?simple';
function urlFor(file){return PAGES_BASE+encodeURIComponent(file).replace(/%2F/g,'/')+SIMPLE}

const ALL = DATA.families.flatMap(f=> f.items.map(it=>({title:it.title,file:it.file,fid:f.id,color:f.color})));

const stack = document.getElementById('oneStack');
const capCount = document.getElementById('capCount');
const dock=document.getElementById('dock');
const dockTitle=document.getElementById('dockTitle');
const dockOpen=document.getElementById('dockOpen');
const dockFrame=document.getElementById('dockFrame');
const baseScrub=document.getElementById('baseScrub');
const stackRange=document.getElementById('stackRange');
const scrubInfo=document.getElementById('scrubInfo');
const prevBtn=document.getElementById('prevBtn');
const nextBtn=document.getElementById('nextBtn');
const zoneTop=document.getElementById('zoneTop');
const zoneBottom=document.getElementById('zoneBottom');

let idx=0; let activeLayer=null;

function fitScale(){
  const w = window.innerWidth; const h = window.innerHeight;
  // Fit so the rotated stack occupies most height while leaving room for dock
  const targetW = 300; const sW=(w-20)/targetW; const sH = Math.min(1.15, Math.max(0.8, h/740));
  const scale = Math.max(0.82, Math.min(1.1, Math.min(sW,sH)));
  document.documentElement.style.setProperty('--scale', String(scale));
}

function build(){
  stack.querySelectorAll('.layer').forEach(n=>n.remove());
  capCount.textContent = `  ${ALL.length}`;
  ALL.forEach((item, i)=>{
    const lay=document.createElement('div'); lay.className=`layer ${item.color}`; lay.dataset.index=String(i);
    const dz=i*parseInt(getComputedStyle(document.documentElement).getPropertyValue('--gapZ'));
    const dy=-i*1.0; lay.style.transform=`translate3d(0px, ${dy}px, ${dz}px)`;
    lay.innerHTML=`<div class=\"tag\" aria-hidden=\"true\">${item.fid.toUpperCase()}</div><div class=\"sub\">${item.fid}</div><div class=\"title\">${item.title}</div>`;
    lay.addEventListener('click', ()=> open(i));
    stack.appendChild(lay);
  });
}

function setActiveLayer(el){ if(activeLayer) activeLayer.classList.remove('active'); activeLayer=el; el?.classList.add('active'); navigator.vibrate?.(8); }

function open(i){ idx=i; const item=ALL[i]; const url=urlFor(item.file); dockTitle.textContent=item.title; dockOpen.href=url; if(dockFrame.src!==url) dockFrame.src=url; dock.classList.add('open'); dock.setAttribute('aria-hidden','false');
  baseScrub.classList.add('open'); stackRange.min=0; stackRange.max=ALL.length-1; stackRange.value=String(i); updateInfo(); setActiveLayer(stack.querySelector(`[data-index=\"${i}\"]`));
}
function close(){ dock.classList.remove('open'); dock.setAttribute('aria-hidden','true'); dockFrame.removeAttribute('src'); baseScrub.classList.remove('open'); setActiveLayer(null); }

document.getElementById('dockClose').addEventListener('click', close);

function updateInfo(){ const fam=ALL[idx].fid; scrubInfo.textContent = `${fam.toUpperCase()}  ${idx+1}/${ALL.length}`; }

stackRange.addEventListener('input', ()=>{ const i=parseInt(stackRange.value); if(Number.isNaN(i)) return; idx=i; const item=ALL[i]; const url=urlFor(item.file); dockTitle.textContent=item.title; dockOpen.href=url; if(dockFrame.src!==url) dockFrame.src=url; updateInfo(); setActiveLayer(stack.querySelector(`[data-index=\"${i}\"]`)); });
prevBtn.addEventListener('click', ()=> step(-1));
nextBtn.addEventListener('click', ()=> step(+1));
zoneTop.addEventListener('click', ()=> step(-1));
zoneBottom.addEventListener('click', ()=> step(+1));

function step(d){ const i=clamp(idx+d, 0, ALL.length-1); stackRange.value=String(i); stackRange.dispatchEvent(new Event('input')); }

// Touch vertical scrub anywhere over the top/bottom zones or stack
let touchY=null, startIdx=null;
[stack, zoneTop, zoneBottom].forEach(el=>{
  el.addEventListener('touchstart', (e)=>{ if(e.touches.length!==1) return; touchY=e.touches[0].clientY; startIdx=idx; }, {passive:true});
  el.addEventListener('touchmove', (e)=>{ if(touchY==null) return; const dy=e.touches[0].clientY - touchY; const step=Math.round(dy/36); const next=clamp(startIdx - step, 0, ALL.length-1); if(next!==idx){ idx=next; stackRange.value=String(idx); stackRange.dispatchEvent(new Event('input')); } }, {passive:true});
  el.addEventListener('touchend', ()=>{ touchY=null; startIdx=null; }, {passive:true});
});

function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

fitScale(); build();
window.addEventListener('resize', fitScale);
window.addEventListener('orientationchange', ()=>setTimeout(fitScale,50));

console.log('[v32-vertical] url test', urlFor('rhm_cards_on_face.html')==='https://hartswf0.github.io/venn-32/rhm_cards_on_face.html?simple');
</script>
</body>
</html>