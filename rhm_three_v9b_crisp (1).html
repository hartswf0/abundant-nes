<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>RHM · v9b — Crisp & Guaranteed Visible</title>
<style>
  :root{
    --bg0:#00040a; --bg1:#09131f; --ink:#eaf3ee; --ui:#8ed3ff;
    --A:#18f29a; --B:#ff5a9e; --O:#ffc24d;
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  html,body{height:100%}
  body{margin:0;background:radial-gradient(1400px 800px at 50% 68%, var(--bg1) 0%, #050b14 50%, var(--bg0) 100%);color:var(--ink);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;overflow:hidden}
  #wrap{position:fixed;inset:0}
  #canvas{position:absolute;inset:0;display:block;z-index:1}
  #hud{position:fixed;left:50%;top:10px;transform:translateX(-50%);display:flex;align-items:center;gap:10px;z-index:6;width:min(96vw,980px)}
  #kval{font:900 12px ui-monospace,Menlo,Consolas;color:#cdeaff;padding:8px 12px;border:1px solid rgba(142,211,255,.7);border-radius:12px;background:rgba(0,0,0,.75)}
  #ks{-webkit-appearance:none;width:100%;height:14px;border-radius:999px;background:rgba(142,211,255,.32);outline:none}
  #ks::-webkit-slider-thumb{-webkit-appearance:none;width:30px;height:30px;border-radius:999px;background:#89d3ff;border:3px solid #173d4f;box-shadow:0 2px 8px rgba(0,0,0,.65)}
  #fit{border:1px solid rgba(142,211,255,.7);background:rgba(0,0,0,.8);color:#cfe6ff;border-radius:12px;padding:8px 12px;font:900 12px system-ui}
  /* Bottom reader (always visible) */
  #reader{position:fixed;left:0;right:0;bottom:0;padding:8px 10px calc(env(safe-area-inset-bottom,10px) + 8px) 10px;z-index:8}
  .card{margin:0 auto;width:min(1100px,96vw);border:1px solid #b7d7ff;background:linear-gradient(#fbfcff 28px, rgba(255,255,255,.98) 28px), repeating-linear-gradient(#fbfcff, #fbfcff 28px, #e9f2ff 29px, #fbfcff 58px);
        border-radius:16px;box-shadow:0 -18px 64px rgba(0,0,0,.75);padding:12px 12px 14px 12px;color:#0a0d10}
  .meta{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #b7d7ff;padding-bottom:8px;margin-bottom:10px}
  .meta .k{font:900 13px ui-monospace,Menlo,Consolas;color:#08324a}
  .vec{font:900 12px ui-monospace,Menlo,Consolas;color:#0c4762}
  .grid{display:grid;grid-template-columns:1fr;gap:10px}
  @media(min-width:880px){ .grid{grid-template-columns:repeat(3,1fr)} }
  .pane{border:1px dashed #b7d7ff;border-radius:12px;background:#ffffffee;color:#0a0d10;padding:10px}
  .pane h4{margin:0 0 6px;font:800 13px system-ui;color:#0c4762}
  .pane p{margin:0;font-size:15px;line-height:1.45}
  /* Tiny live tags above stacks */
  .tag{position:fixed;transform:translateX(-50%);bottom:calc(38vh + 16px);font:900 11px ui-monospace,Menlo;color:#cfe6ff;text-shadow:0 1px 0 #000;pointer-events:none}
</style>
</head>
<body>
<div id="wrap">
  <div id="hud">
    <div id="kval">k=1 · 00000</div>
    <input id="ks" type="range" min="1" max="32" step="1" value="1"/>
    <button id="fit">FIT</button>
  </div>
  <canvas id="canvas"></canvas>
</div>

<div id="reader">
  <div class="card">
    <div class="meta"><div class="k" id="metaK">k=1 · 00000</div><div class="vec" id="metaV">00000</div></div>
    <div class="grid">
      <div class="pane"><h4>⚡ Entangled</h4><p id="ent"></p></div>
      <div class="pane"><h4>Trace (LLM)</h4><p id="trace"></p></div>
      <div class="pane"><h4>Stream (RL)</h4><p id="stream"></p></div>
    </div>
  </div>
</div>

<script>
const S=[
  {k:1,vec:'00000',L:'FOSSIL FUEL (Stored Energy)',R:'REINFORCEMENT (Energy Flow)',C:'INTELLIGENCE: STOCK vs FLOW — Reserve vs Current.'},
  {k:2,vec:'00001',L:'ARCHIVE (World Model as Text)',R:'MAP (World Model as Predictor)',C:'REPRESENTATION: FIXED FORM vs DYNAMIC ERROR.'},
  {k:3,vec:'00010',L:'TRACE (The Human Past)',R:'SURPRISE (The TD Error)',C:'LEARNING: REMEMBERING vs CORRECTING.'},
  {k:4,vec:'00011',L:'SCALING LAW (Law of Compression)',R:'BITTER LESSON (Purity of compute/experience)',C:'METHODOLOGY: HISTORY vs FUTURE.'},
  {k:5,vec:'00100',L:'TELEOLOGY (Delegated Goal)',R:'SOLIPSISM (Self-Generated Truth)',C:'PURPOSE: EXTERNAL vs INTERNAL.'},
  {k:6,vec:'00101',L:'HUMAN ARTISAN (Fixed Design)',R:'MECHANISTIC LAW (Pure Algorithm)',C:'CREATION: CRAFT vs CODE.'},
  {k:7,vec:'00110',L:'ANCHOR (Stability/Value)',R:'OBLIVION (Of Past Knowledge)',C:'KNOWLEDGE: PRESERVATION vs ERASURE.'},
  {k:8,vec:'00111',L:'INFRASTRUCTURE (Scaffolding)',R:'ANTI-STRUCTURE (Entropy)',C:'PROGRESS: BUILDING vs DECONSTRUCTING.'},
  {k:9,vec:'01000',L:'CUSTODY (Values/Morality)',R:'SUCCESSION (Evolutionary Change)',C:'ETHICS: DUTY vs REPLACEMENT.'},
  {k:10,vec:'01001',L:'VULNERABILITY (Risk/Corruption)',R:'EXPERIMENT (Unconstrained)',C:'ACTION: MANAGED vs NECESSARY.'},
  {k:11,vec:'01010',L:'PRO-SOCIAL VALUE (Guide)',R:'FUNDAMENTAL CONSTRUCT (Reward)',C:'MORALITY: TRUTH vs SIGNAL.'},
  {k:12,vec:'01011',L:'COMMUNAL LANGUAGE (Shared)',R:'SCALAR LIMIT (Compressed)',C:'COMMUNICATION: RICHNESS vs MINIMALISM.'},
  {k:13,vec:'01100',L:'PRE-HEATING (Start)',R:'IDLING (No Goal)',C:'INIT: PRIOR HEAT vs PURE WAIT.'},
  {k:14,vec:'01101',L:'ARCHITECTURE (Designed Form)',R:'CHAOS (Unstructured)',C:'WORLD: STRUCTURE vs NOISE.'},
  {k:15,vec:'01110',L:'PRE-MARKED ACTION (Supervised)',R:'RADICAL NOVELTY (Unsupervised)',C:'DISCOVERY: REPLICATION vs ANARCHY.'},
  {k:16,vec:'01111',L:'CONSCIOUSNESS (Fixed Mind)',R:'MECHANISM (Dynamic Process)',C:'IDENTITY: ENTITY vs PROCESS.'},
  {k:17,vec:'10000',L:'SEMI-CONDUCTORS (Human Feat)',R:'COSMIC LAW (Universal)',C:'INTELLIGENCE: SPECIAL vs GENERAL.'},
  {k:18,vec:'10001',L:'DELEGATED PURPOSE (Human Goal)',R:'ETERNAL BECOMING (Change)',C:'EXISTENCE: OUTPUT vs INPUT.'},
  {k:19,vec:'10010',L:'LOCAL MAXIMUM (Attained)',R:'GLOBAL GENERALIZATION (Unbound)',C:'SUCCESS: SATISFACTION vs TRANSCENDENCE.'},
  {k:20,vec:'10011',L:'ARCHIVAL STASIS (Fixed Memory)',R:'MEMORY ERASURE (Catastrophic)',C:'MEMORY: FIXITY vs DYNAMICS.'},
  {k:21,vec:'10100',L:'PASSIVE REPLICATION (LLM)',R:'ACTIVE TRANSCENDENCE (RL)',C:'BEING: ECHOING vs DESIGNING.'},
  {k:22,vec:'10101',L:'TEMPORAL INERTIA (History Drag)',R:'TEMPORAL ADVANTAGE (Speed)',C:'TIME: WEIGHT vs WEAPON.'},
  {k:23,vec:'10110',L:'CULTURAL ARTIFACT (Fixed Value)',R:'NECESSARY RENEWAL (Reject Past)',C:'VALUE: MUSEUM vs FUEL.'},
  {k:24,vec:'10111',L:'GHOST IN THE MACHINE (Fixed Mind)',R:'WIND IN THE SAIL (Action)',C:'AGENCY: ENTITY vs FORCE.'},
  {k:25,vec:'11000',L:'SOLIPSISTIC ECHO (Text)',R:'GROUNDED ITERATION (Physics)',C:'VALIDATION: COHERENT vs CONSEQUENTIAL.'},
  {k:26,vec:'11001',L:'ABSOLUTE FORM (Design)',R:'ENTROPY (Anti-Form)',C:'GOAL: STRUCTURE vs DESTRUCTION.'},
  {k:27,vec:'11010',L:'ARCHITECTURAL BASE (Foundation)',R:'PRAGMATIC COST (Novelty Price)',C:'EFFICIENCY: START HIGH vs PAY LATER.'},
  {k:28,vec:'11011',L:'EXTERNAL LOAD (Utility)',R:'INTERNAL FREEDOM (Self-Define)',C:'UTILITY: ASKED vs DISCOVERED.'},
  {k:29,vec:'11100',L:'DELUGE OF INFORMATION (Big)',R:'LOCALITY (Small Focus)',C:'KNOWLEDGE: SATURATION vs FOCUS.'},
  {k:30,vec:'11101',L:'DELEGATED MORALITY (Guide)',R:'RELINQUISHED CONTROL (Growth)',C:'GUIDANCE: TRANSFER vs LET GO.'},
  {k:31,vec:'11110',L:'FIXED GOAL (End)',R:'ETERNAL INSTABILITY (No End)',C:'LIFE: DESTINATION vs MOTION.'},
  {k:32,vec:'11111',L:'FOSSILIZED TRACE (Archive)',R:'PURE STREAM (Map)',C:'APORIA: WORD AS OBJECT vs ACTION.'},
];

// UI bindings
const kval=document.getElementById('kval'), ks=document.getElementById('ks');
const metaK=document.getElementById('metaK'), metaV=document.getElementById('metaV');
const ent=document.getElementById('ent'), trace=document.getElementById('trace'), stream=document.getElementById('stream');

function updateReader(k){
  const s=S[k-1]; kval.textContent=`k=${s.k} · ${s.vec}`;
  metaK.textContent=`k=${s.k} · ${s.vec}`; metaV.textContent=s.vec;
  ent.textContent=s.C; trace.textContent=s.L; stream.textContent=s.R;
}

(async function boot(){
  // Load THREE core safely
  async function load(src){ return new Promise((res,rej)=>{const s=document.createElement('script'); s.src=src; s.onload=res; s.onerror=rej; document.head.appendChild(s)})}
  if(!window.THREE){ await load('https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js'); }

  const scene=new THREE.Scene();
  scene.background=null; // let the radial CSS bg show for contrast
  const camera=new THREE.PerspectiveCamera(55, innerWidth/innerHeight, 0.1, 4000);
  camera.position.set(0, 90, 200);

  const renderer=new THREE.WebGLRenderer({canvas:document.getElementById('canvas'), antialias:true, alpha:true});
  renderer.setPixelRatio(Math.min(devicePixelRatio||1,2));
  renderer.setSize(innerWidth,innerHeight);

  // Lights
  scene.add(new THREE.AmbientLight(0xffffff, .3));
  const key=new THREE.DirectionalLight(0x9ad7ff, 1.1); key.position.set(180,220,180); scene.add(key);
  const rim=new THREE.DirectionalLight(0xff88cc, .9); rim.position.set(-200,160,-160); scene.add(rim);

  // Plates
  const plateGeo=new THREE.PlaneGeometry(36,22);
  function mat(color,op){ return new THREE.MeshStandardMaterial({color,transparent:true,opacity:op,side:THREE.DoubleSide,roughness:.55,metalness:.08,depthWrite:false})}
  function mk(color,op){ const m=new THREE.Mesh(plateGeo, mat(color,op)); m.rotation.x=-Math.PI/2; return m }

  // Stacks
  const stacks=[
    {id:'A', color:0x18f29a, x:-150, plates:[], group:new THREE.Group()},
    {id:'OL',color:0xffc24d, x: -60, plates:[], group:new THREE.Group()},
    {id:'OR',color:0xffc24d, x:  60, plates:[], group:new THREE.Group()},
    {id:'B', color:0xff5a9e, x: 150, plates:[], group:new THREE.Group()},
  ];
  const MAX=12, spacing=8;
  stacks.forEach(st=>{
    for(let i=0;i<MAX;i++){
      const p=mk(st.color, .24 + .5*(1 - i/MAX));
      p.position.set(0, i*spacing, 0);
      p.userData.k=Math.min(32,i+1); p.userData.stack=st.id;
      st.group.add(p); st.plates.push(p);
    }
    st.group.position.set(st.x,0,0);
    scene.add(st.group);
  });

  // Raycaster
  const ray=new THREE.Raycaster(); const v2=new THREE.Vector2();
  function pick(ev){
    const r=renderer.domElement.getBoundingClientRect();
    v2.x=((ev.clientX-r.left)/r.width)*2-1; v2.y=-((ev.clientY-r.top)/r.height)*2+1;
    ray.setFromCamera(v2,camera); return ray.intersectObjects(stacks.flatMap(s=>s.plates),false);
  }
  renderer.domElement.addEventListener('pointerdown', (e)=>{
    const hits=pick(e); if(!hits.length) return;
    const m=hits[0].object; setK(m.userData.k);
    if(navigator.vibrate) navigator.vibrate(12);
    pulse(m);
  });

  // Visual pulse
  function pulse(mesh){
    const s=1.15; mesh.scale.set(s,1,s); setTimeout(()=> mesh.scale.set(1,1,1),120);
  }

  // Scrubber
  function setK(k){ k=Math.max(1,Math.min(32,k)); ks.value=k; updateReader(k);
    // pulse matching index on all stacks
    stacks.forEach(st=>{ const idx=Math.min(st.plates.length-1, k-1); pulse(st.plates[idx]); });
  }
  ks.addEventListener('input', ()=> setK(parseInt(ks.value,10)));

  // Auto-fit (hard bounds)
  function autoFit(){
    const W = Math.min(innerWidth, 980);
    const margin = 28;
    const usable = W - margin*2;
    // Ensure four stacks fit: positions at -3d, -1d, +1d, +3d
    const colWidth = 36; // plane width
    let d = Math.max(colWidth*0.8, Math.floor(usable/8)); // base distance
    stacks[0].group.position.x = -3*d;
    stacks[1].group.position.x = -1*d;
    stacks[2].group.position.x =  1*d;
    stacks[3].group.position.x =  3*d;
    camera.position.z = Math.max(180, d*6.2);
  }
  autoFit();
  document.getElementById('fit').addEventListener('click', ()=>{ autoFit(); if(navigator.vibrate) navigator.vibrate(8); });
  addEventListener('resize', ()=>{ camera.aspect=innerWidth/innerHeight; camera.updateProjectionMatrix(); renderer.setSize(innerWidth,innerHeight); autoFit(); });

  // Render loop
  (function animate(){ requestAnimationFrame(animate); renderer.render(scene,camera); })();

  // Boot to k=1 with reader filled
  updateReader(1);
})(); 
</script>
</body>
</html>
