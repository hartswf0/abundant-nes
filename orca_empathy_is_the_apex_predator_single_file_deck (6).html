<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>SEA SEQUENCER — Cinematic (iframe-srcdoc safe)</title>
<style>
  html,body{height:100%}
  body{margin:0; background:#000; overflow:hidden; font:14px/1.2 Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif}
  #app{position:fixed; inset:0; background:#000}
  iframe#orca{position:absolute; inset:0; width:100%; height:100%; border:0}
</style>
</head>
<body>
<div id="app">
  <!--
    IMPORTANT: We embed the entire app via <iframe srcdoc> so NO <script> tags
    appear in the outer document. This avoids environments that call document.write()
    and choke on the `</script>` substring. The inner document is fully self-contained.
  -->
  <iframe id="orca" title="Sea Sequencer" srcdoc='<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>SEA SEQUENCER — Cinematic</title><style>:root{--abyss:#03080f;--ink:#e9f6ff;--muted:#94b8cc;--blue:#7fdcff;--cyan:#58e0ff;--foam:#dff4ff;--glass:rgba(180,230,255,.07);--shadow:0 16px 38px rgba(0,0,0,.55),0 2px 12px rgba(0,0,0,.35)}*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;touch-action:none}html,body{height:100%}body{margin:0;background:radial-gradient(1200px 800px at 50% 40%,#061a2a 0%,var(--abyss) 60%);color:var(--ink);overflow:hidden}#stage{position:fixed;inset:0}canvas#scene{position:absolute;inset:0;display:block}/* Floating Button */#fab{position:fixed;right:16px;bottom:16px;width:56px;height:56px;border-radius:50%;background:linear-gradient(180deg,#58e0ff,#2a8ac2);box-shadow:0 10px 22px rgba(0,0,0,.45);border:none;color:#02131e;font-weight:700;letter-spacing:.06em}#fab:active{transform:scale(.98)}/* Overlay controls (hidden by default) */#panel{position:fixed;left:0;right:0;bottom:-260px;height:260px;background:linear-gradient(180deg,rgba(3,8,15,.0),rgba(3,8,15,.92));backdrop-filter:blur(12px);box-shadow:0 -12px 28px rgba(0,0,0,.4);transition:transform .28s ease, bottom .28s ease;display:flex;gap:12px;padding:16px}#panel.open{bottom:0} .ss{flex:1;min-width:0;height:100%;border-radius:18px;border:1px solid rgba(160,210,255,.18);background:var(--glass);box-shadow:var(--shadow);position:relative;overflow:hidden;display:flex;align-items:flex-end;justify-content:center}.cap{position:absolute;top:10px;left:12px;font-size:11px;letter-spacing:.12em;color:var(--muted)}.legend{position:absolute;bottom:10px;width:100%;text-align:center;font-size:12px;color:#cfe8ff}.col{position:absolute;inset:20px 12px 26px 12px;display:grid;grid-template-rows:repeat(10,1fr);row-gap:6px;width:calc(100% - 24px)}.tile{border-radius:10px;background:linear-gradient(180deg,rgba(120,200,255,.18),rgba(255,255,255,.06));transform:translateZ(0);transition:transform .06s linear,box-shadow .08s ease}.tile.lit{box-shadow:0 0 0 1px rgba(127,220,255,.35),inset 0 0 18px rgba(127,220,255,.18),0 6px 18px rgba(127,220,255,.25)}/* Onboarding veil */#veil{position:fixed;inset:0;background:radial-gradient(1200px 800px at 50% 40%,rgba(12,32,52,.75),rgba(3,8,15,.95));display:flex;align-items:center;justify-content:center;flex-direction:column;gap:18px}#veil button{padding:12px 18px;border-radius:14px;border:1px solid rgba(160,210,255,.3);background:linear-gradient(180deg,rgba(120,200,255,.12),rgba(255,255,255,.06));color:#cfe8ff;font-weight:600;letter-spacing:.06em;box-shadow:0 10px 22px rgba(0,0,0,.45)}#veil p{max-width:480px;text-align:center;color:#cfe8ff;margin:0 16px}</style></head><body role="application"><div id="stage"><canvas id="scene"></canvas></div><div id="veil"><p>Tap to enter the ocean. Audio will start on first tap. Controls are hidden — use the blue circle to open them.</p><button id="enter">Enter</button></div><button id="fab" aria-label="Controls">●</button><div id="panel" aria-label="Controls"><div class="ss" id="tempoSS"><div class="cap">TEMP</div><div class="col" id="tempoCol"></div><div class="legend" id="tempoTxt">120 BPM</div></div><div class="ss" id="depthSS"><div class="cap">DEPTH</div><div class="col" id="depthCol"></div><div class="legend" id="depthTxt">30%</div></div><div class="ss" id="mixSS"><div class="cap">MIX</div><div class="col" id="mixCol"></div><div class="legend" id="mixTxt">Balanced</div></div></div><script>"use strict";(function(){var DPR=Math.max(1,window.devicePixelRatio||1);var canvas=document.getElementById("scene");var ctx=canvas.getContext("2d");var W=0,H=0;function resize(){W=window.innerWidth;H=window.innerHeight;canvas.width=W*DPR;canvas.height=H*DPR;canvas.style.width=W+"px";canvas.style.height=H+"px";ctx.setTransform(DPR,0,0,DPR,0,0)}window.addEventListener("resize",resize,{passive:true});resize();var ROWS=3,COLS=16,STEPS=10;var colors=["#31bbff","#7fdcff","#cfe9ff"];var grid=[];for(var r=0;r<ROWS;r++){var row=[];for(var c=0;c<COLS;c++){row.push({on:Math.random()<0.2,val:Math.random()*0.8+0.1,pulse:0})}grid.push(row)}var state={playing:false,bpm:120,t:0,playCol:0,now:0,depth:0.3,mixMode:0};function cellRect(c,r){var pad=24;var gw=W-pad*2;var gh=H-pad*2;var cw=gw/COLS;var ch=gh/ROWS;var x=pad+c*cw;var y=pad+r*ch;return{x:x,y:y,w:cw*0.92,h:ch*0.8}}function roundRect(x,y,w,h,r){ctx.beginPath();ctx.moveTo(x+r,y);ctx.arcTo(x+w,y,x+w,y+h,r);ctx.arcTo(x+w,y+h,x,y+h,r);ctx.arcTo(x,y+h,x,y,r);ctx.arcTo(x,y,x+w,y,r);ctx.closePath()}function draw(){ctx.clearRect(0,0,W,H);for(var r=0;r<ROWS;r++){var fr=cellRect(0,r);var g=ctx.createLinearGradient(0,fr.y,0,fr.y+fr.h);g.addColorStop(0,"rgba(120,200,255,0.045)");g.addColorStop(1,"rgba(120,200,255,0.0)");ctx.fillStyle=g;ctx.fillRect(0,fr.y,W,fr.h)}var ph=cellRect(state.playCol,0);ctx.save();ctx.globalAlpha=0.22;ctx.fillStyle="#7fdcff";ctx.fillRect(ph.x+ph.w*0.5,0,2.5,H);ctx.restore();for(var r2=0;r2<ROWS;r2++){for(var c2=0;c2<COLS;c2++){var cell=grid[r2][c2];var R=cellRect(c2,r2);var color=colors[r2];var litTiles=Math.round(cell.val*STEPS);ctx.save();ctx.translate(R.x,R.y);ctx.globalAlpha=cell.on?(0.86-0.26*r2):0.16;ctx.fillStyle=color;roundRect(0,0,R.w,R.h,Math.min(12,R.h*0.24));ctx.fill();var gap=5,tileH=(R.h-gap*(STEPS-1))/STEPS;for(var i=0;i<STEPS;i++){var ty=R.h-(i+1)*tileH - i*gap;ctx.globalAlpha=(i<litTiles)?0.95:0.18;ctx.fillStyle=color;roundRect(4,ty,R.w-8,tileH,8);ctx.fill()}var age=state.now-cell.pulse;var pulseA=Math.max(0,0.7-age*2.8);if(pulseA>0){ctx.globalAlpha=pulseA;ctx.strokeStyle="#ffffff";ctx.lineWidth=1.5;roundRect(2,2,R.w-4,R.h-4,Math.min(10,R.h*0.22));ctx.stroke()}ctx.restore()}}}function hitCell(mx,my){for(var r=0;r<ROWS;r++){for(var c=0;c<COLS;c++){var R=cellRect(c,r);if(mx>=R.x&&mx<=R.x+R.w&&my>=R.y&&my<=R.y+R.h){return{r:r,c:c,R:R}}}}return null}var dragging=false,anchorY=0,anchorVal=0,dragCell=null,moved=false;canvas.addEventListener("pointerdown",function(e){var rect=canvas.getBoundingClientRect();var mx=e.clientX-rect.left,my=e.clientY-rect.top;var hit=hitCell(mx,my);if(!hit)return;canvas.setPointerCapture(e.pointerId);dragging=true;moved=false;dragCell=hit;anchorY=my;anchorVal=grid[hit.r][hit.c].val});canvas.addEventListener("pointermove",function(e){if(!dragging)return;var my=e.clientY-canvas.getBoundingClientRect().top;var dy=(anchorY-my)/(dragCell.R.h);var v=Math.max(0,Math.min(1,anchorVal+dy));var cell=grid[dragCell.r][dragCell.c];cell.val=v;moved=true});window.addEventListener("pointerup",function(){if(!dragging)return;var cell=grid[dragCell.r][dragCell.c];if(!moved){cell.on=!cell.on}dragging=false;dragCell=null});window.addEventListener("pointercancel",function(){dragging=false;dragCell=null});/* AUDIO */var AC=window.AudioContext||window.webkitAudioContext;var audioCtx=null,master=null,busLow=null,busMid=null,busHigh=null,busVerb=null;function ensureAudio(){if(audioCtx)return;audioCtx=new AC();master=audioCtx.createGain();master.gain.value=0.86;master.connect(audioCtx.destination);busLow=audioCtx.createGain();busMid=audioCtx.createGain();busHigh=audioCtx.createGain();busVerb=audioCtx.createGain();busLow.gain.value=0.32;busMid.gain.value=0.22;busHigh.gain.value=0.20;busVerb.gain.value=0.36;var delay=audioCtx.createDelay(0.6),fb=audioCtx.createGain(),lp=audioCtx.createBiquadFilter();delay.delayTime.value=0.32;fb.gain.value=0.28;lp.type="lowpass";lp.frequency.value=1800;busVerb.connect(delay);delay.connect(fb);fb.connect(delay);delay.connect(lp);lp.connect(master);busLow.connect(master);busMid.connect(master);busHigh.connect(master);makeInstruments()}function brownNoise(){var buffer=audioCtx.createBuffer(1,audioCtx.sampleRate*2,audioCtx.sampleRate);var data=buffer.getChannelData(0),last=0;for(var i=0;i<data.length;i++){var white=Math.random()*2-1;data[i]=(last+0.02*white)/(1+0.02);last=data[i]}var src=audioCtx.createBufferSource();src.buffer=buffer;src.loop=true;return src}var L=null,M=null,Hh=null;function makeInstruments(){L=brownNoise();var lBP=audioCtx.createBiquadFilter();lBP.type="bandpass";lBP.frequency.value=40;lBP.Q.value=3;var lG=audioCtx.createGain();lG.gain.value=0.0;L.connect(lBP);lBP.connect(lG);lG.connect(busLow);lG.connect(busVerb);L.start();L._bp=lBP;L._g=lG;var o=audioCtx.createOscillator();o.type="sine";var mBP=audioCtx.createBiquadFilter();mBP.type="bandpass";mBP.frequency.value=520;mBP.Q.value=12;var mG=audioCtx.createGain();mG.gain.value=0.0;o.connect(mBP);mBP.connect(mG);mG.connect(busMid);mG.connect(busVerb);o.start();M={o:o,_bp:mBP,_g:mG};var s=brownNoise();var hHP=audioCtx.createBiquadFilter();hHP.type="highpass";hHP.frequency.value=1200;var hG=audioCtx.createGain();hG.gain.value=0.0;s.connect(hHP);hHP.connect(hG);hG.connect(busHigh);hG.connect(busVerb);s.start();Hh={src:s,_hp:hHP,_g:hG}}function env(node,a,d,peak){if(!audioCtx)return;var t=audioCtx.currentTime;try{node.gain.cancelScheduledValues(t)}catch(e){}node.gain.setValueAtTime(0.0001,t);node.gain.linearRampToValueAtTime(peak,t+(a||0.01));node.gain.exponentialRampToValueAtTime(0.0001,t+(a||0.01)+(d||0.4))}function trigger(r,v){if(!audioCtx)return;if(r===0){L._bp.frequency.setTargetAtTime(36,audioCtx.currentTime,0.25);env(L._g,0.03,1.2,0.18+0.30*v)}else if(r===1){M._bp.frequency.setTargetAtTime(420,audioCtx.currentTime,0.02);env(M._g,0.008,0.25,0.16+0.34*v)}else{Hh._hp.frequency.setTargetAtTime(1400,audioCtx.currentTime,0.03);env(Hh._g,0.006,0.22,0.12+0.30*v)}}/* Transport */var last=performance.now();function step(now){var dt=Math.min(0.05,(now-last)/1000);last=now;state.now+=dt;if(state.playing){var bps=state.bpm/60;state.t+=dt*bps;var col=Math.floor(state.t)%COLS;if(col!==state.playCol){state.playCol=col;for(var r=0;r<ROWS;r++){var cell=grid[r][col];if(cell.on){cell.pulse=state.now;trigger(r,cell.val)}}}}draw();requestAnimationFrame(step)}requestAnimationFrame(step);/* Controls open/close */var fab=document.getElementById("fab");var panel=document.getElementById("panel");fab.addEventListener("pointerdown",function(){panel.classList.toggle("open")});/* Onboarding */var enter=document.getElementById("enter");enter.addEventListener("pointerdown",function(){ensureAudio();if(audioCtx&&audioCtx.state==="suspended"){audioCtx.resume()}state.playing=true;document.getElementById("veil").style.display="none"});/* Build slider tiles in panel */function buildTiles(id,valSetter,txt){var col=document.getElementById(id+"Col");col.innerHTML="";var T=10;for(var i=0;i<T;i++){var d=document.createElement("div");d.className="tile";col.appendChild(d)}var v=0.5;var tiles=col.children;function update(){var lit=Math.round(v*T);for(var i=0;i<T;i++){tiles[T-1-i].classList.toggle("lit",i<lit)} if(txt) txt.textContent = id==="tempo"?(Math.round(40+v*160)+" BPM"): id==="depth"?(Math.round(v*100)+"%"):(v<0.33?"Low-heavy":(v>0.66?"High-shimmer":"Balanced"))}update();var grabbing=false,sy=0,sv=v;col.parentElement.addEventListener("pointerdown",function(e){grabbing=true;sy=e.clientY;sv=v;col.parentElement.setPointerCapture(e.pointerId)});col.parentElement.addEventListener("pointermove",function(e){if(!grabbing)return;var dy=(sy-e.clientY)/140;v=Math.max(0,Math.min(1,sv+dy));valSetter(v);update()});col.parentElement.addEventListener("pointerup",function(){grabbing=false})}
var tempoTxt=document.getElementById("tempoTxt");var depthTxt=document.getElementById("depthTxt");var mixTxt=document.getElementById("mixTxt");buildTiles("tempo",function(v){state.bpm=Math.round(40+v*160);tempoTxt.textContent=state.bpm+" BPM"},tempoTxt);buildTiles("depth",function(v){state.depth=v;if(busVerb) busVerb.gain.setTargetAtTime(v*0.6,audioCtx.currentTime,0.05);depthTxt.textContent=Math.round(v*100)+"%"},depthTxt);buildTiles("mix",function(v){state.mixMode=v; if(busLow&&busHigh){busLow.gain.setTargetAtTime(v<0.33?0.5:0.32,audioCtx.currentTime,0.06);busHigh.gain.setTargetAtTime(v>0.66?0.40:0.22,audioCtx.currentTime,0.06)}mixTxt.textContent=(v<0.33?"Low-heavy":(v>0.66?"High-shimmer":"Balanced"))},mixTxt);
/* Self-tests */try{console.assert(document.querySelectorAll("canvas#scene").length===1,"Canvas present");console.assert(document.querySelectorAll("#panel .ss").length===3,"Three controls exist");console.log("[Sea Sequencer Cinematic] self-tests passed")}catch(e){console.warn("[Sea Sequencer Cinematic] self-tests issue",e)}
})();</script></body></html>'></iframe>
</div>
</body>
</html>
