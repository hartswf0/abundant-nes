<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Broadcast Hyper-Tetra Console — Full</title>
<style>
  :root{
    --bg:#06090c; --fg:#f2f7fb; --muted:#99aabb;
    --edge:#8fb6ff; --vert:#58d5ff;
    --fa:#58b3ff; --fa-fill:#0e2134;
    --fb:#5ad1b4; --fb-fill:#0f2b24;
    --fc:#c07bff; --fc-fill:#201433;
    --fd:#ffc85a; --fd-fill:#2e250f;
  }
  html,body{height:100%; margin:0; background:var(--bg); color:var(--fg); font-family:system-ui, sans-serif;}
  #app{position:fixed; inset:0; display:grid; grid-template-rows:auto 1fr auto;}
  header{padding:8px; display:flex; align-items:center; gap:8px; background:#0b0f14cc; border-bottom:1px solid #10161d;}
  header h1{font-size:14px; font-weight:600; margin:0; color:var(--muted)}
  .chip{display:inline-flex; align-items:center; gap:4px; padding:4px 8px; border-radius:999px; border:1px solid #17222b; background:#0c1117; cursor:pointer; font-size:12px;}
  .chip[aria-pressed="true"]{outline:2px solid currentColor}
  .dot{width:10px; height:10px; border-radius:999px; background:currentColor}
  .fa{color:var(--fa)} .fb{color:var(--fb)} .fc{color:var(--fc)} .fd{color:var(--fd)}

  main{position:relative; overflow:hidden}
  canvas#gl{position:absolute; inset:0; width:100%; height:100%; touch-action:none}

  .hud{position:absolute; bottom:12px; left:50%; transform:translateX(-50%); background:#0c1117dd; border:1px solid #17222b; border-radius:12px; padding:10px; display:flex; flex-direction:column; gap:8px; font-size:12px; min-width:280px;}
  .hud h2{margin:0; font-size:13px; display:flex; align-items:center; gap:6px;}
  .hud label{display:flex; align-items:center; justify-content:space-between; gap:6px;}
  .hud input[type=range], .hud input[type=number]{flex:1;}

  .toast{position:absolute; bottom:80px; left:50%; transform:translateX(-50%); background:#0a0f14; color:#9cff8a; border:1px solid #13202c; border-radius:8px; padding:6px 10px; font-size:12px; opacity:0; transition:opacity .25s;}
  .toast.show{opacity:1}
</style>
</head>
<body>
<div id="app">
  <header>
    <h1>Broadcast Hyper‑Tetra Console</h1>
    <div id="faceChips" style="display:flex; gap:6px; margin-left:12px">
      <button class="chip fa" data-face="0" aria-pressed="true"><span class="dot"></span>A</button>
      <button class="chip fb" data-face="1"><span class="dot"></span>B</button>
      <button class="chip fc" data-face="2"><span class="dot"></span>C</button>
      <button class="chip fd" data-face="3"><span class="dot"></span>D</button>
    </div>
  </header>
  <main>
    <canvas id="gl"></canvas>
    <div id="hud" class="hud">
      <h2><span id="statusDot" class="dot" style="color:var(--fa)"></span><span id="statusFace">Channel A</span></h2>
      <label>Layer <input id="layerSlider" type="range" min="1" max="96" value="1"><input id="layerNum" type="number" min="1" max="96" value="1"></label>
      <label>Span <input id="spanSlider" type="range" min="10" max="100" value="25"></label>
      <label>Speed <input id="speedSlider" type="range" min="0" max="200" value="0"></label>
      <label><input id="modeToggle" type="checkbox"> Orbit mode</label>
    </div>
    <div id="toast" class="toast"></div>
  </main>
  <footer style="padding:6px; font-size:11px; color:var(--muted); background:#0b0f14cc; border-top:1px solid #10161d">Single file. Broadcast console. Manual control authority only.</footer>
</div>
<script>
(() => {
  const canvas=document.getElementById('gl');
  const ctx=canvas.getContext('2d',{alpha:false});
  const DPR=Math.min(2,devicePixelRatio||1);
  function resize(){const r=canvas.getBoundingClientRect(); canvas.width=r.width*DPR; canvas.height=r.height*DPR; ctx.setTransform(DPR,0,0,DPR,0,0);} new ResizeObserver(resize).observe(canvas);

  const V=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]];
  const E=[[0,1],[0,2],[0,3],[1,2],[1,3],[2,3]];
  const F=[[0,1,2],[0,1,3],[0,2,3],[1,2,3]];
  const FACE_INFO=[
    {name:'Channel A', stroke:get('--fa'), fill:get('--fa-fill')},
    {name:'Channel B', stroke:get('--fb'), fill:get('--fb-fill')},
    {name:'Channel C', stroke:get('--fc'), fill:get('--fc-fill')},
    {name:'Channel D', stroke:get('--fd'), fill:get('--fd-fill')},
  ];
  function get(v){return getComputedStyle(document.documentElement).getPropertyValue(v).trim();}

  let rotX=0.6, rotY=-0.3, rotZ=0; let camDist=5; let scale=1.2;
  let activeFace=0; let layerIdx=[0,0,0,0]; let span=[24,24,24,24]; let speed=[0,0,0,0];
  const hud={ face:document.getElementById('statusFace'), dot:document.getElementById('statusDot'),
    layerSlider:document.getElementById('layerSlider'), layerNum:document.getElementById('layerNum'),
    spanSlider:document.getElementById('spanSlider'), speedSlider:document.getElementById('speedSlider'),
    orbit:document.getElementById('modeToggle') };
  const toast=document.getElementById('toast');

  document.getElementById('faceChips').onclick=e=>{const b=e.target.closest('[data-face]'); if(!b)return; setFace(+b.dataset.face);};
  hud.layerSlider.oninput=()=>{setLayer(activeFace, +hud.layerSlider.value-1)};
  hud.layerNum.oninput=()=>{setLayer(activeFace, +hud.layerNum.value-1)};
  hud.spanSlider.oninput=()=>{span[activeFace]=+hud.spanSlider.value;};
  hud.speedSlider.oninput=()=>{speed[activeFace]=+hud.speedSlider.value/100;};

  function setFace(i){activeFace=i; document.querySelectorAll('#faceChips .chip').forEach((c,j)=>c.setAttribute('aria-pressed', j===i));
    hud.face.textContent=FACE_INFO[i].name; hud.dot.style.color=FACE_INFO[i].stroke;
    animateToFace(i); announce(`${FACE_INFO[i].name} selected`); syncHUD(); }
  function setLayer(i,n){layerIdx[i]=Math.max(0,Math.min(95,n)); syncHUD(); announce(`${FACE_INFO[i].name} Layer ${layerIdx[i]+1}`); }
  function syncHUD(){hud.layerSlider.value=layerIdx[activeFace]+1; hud.layerNum.value=layerIdx[activeFace]+1; hud.spanSlider.value=span[activeFace]; hud.speedSlider.value=Math.round(speed[activeFace]*100);}

  function announce(t){toast.textContent=t; toast.classList.add('show'); clearTimeout(announce._t); announce._t=setTimeout(()=>toast.classList.remove('show'),1200);}

  function animateToFace(i){ // simple snap: rotate to orient selected face
    if(i===0){rotX=0.6; rotY=-0.3;}
    if(i===1){rotX=0.6; rotY=1.2;}
    if(i===2){rotX=-0.6; rotY=-0.3;}
    if(i===3){rotX=-0.6; rotY=1.2;}
  }

  function rotMat(ax,ay,az){const cx=Math.cos(ax),sx=Math.sin(ax),cy=Math.cos(ay),sy=Math.sin(ay),cz=Math.cos(az),sz=Math.sin(az); return [cz*cy,cz*sy*sx-sz*cx,cz*sy*cx+sz*sx, sz*cy,sz*sy*sx+cz*cx,sz*sy*cx-cz*sx,-sy,cy*sx,cy*cx];}
  const mul=(m,v)=>{const [x,y,z]=v;return[(m[0]*x+m[1]*y+m[2]*z)*scale,(m[3]*x+m[4]*y+m[5]*z)*scale,(m[6]*x+m[7]*y+m[8]*z)*scale]};
  const proj=(p,w,h)=>{const [x,y,z]=p;const zz=z+camDist;const f=260/zz;return[w*0.5+x*f,h*0.5-y*f,zz];};

  function draw(){const w=canvas.clientWidth,h=canvas.clientHeight; if(canvas.width!==w*DPR) resize(); ctx.clearRect(0,0,w,h);
    const m=rotMat(rotX,rotY,rotZ); const PV=V.map(v=>proj(mul(m,v),w,h));
    const faces=F.map((f,i)=>({i,z:(PV[f[0]][2]+PV[f[1]][2]+PV[f[2]][2])/3})).sort((a,b)=>b.z-a.z);
    for(const fd of faces){const i=fd.i; const a=PV[F[i][0]],b=PV[F[i][1]],c=PV[F[i][2]]; const info=FACE_INFO[i]; ctx.beginPath(); ctx.moveTo(a[0],a[1]); ctx.lineTo(b[0],b[1]); ctx.lineTo(c[0],c[1]); ctx.closePath(); if(i===activeFace){ctx.fillStyle=info.fill; ctx.globalAlpha=0.9; ctx.fill(); ctx.strokeStyle=info.stroke; ctx.lineWidth=3; ctx.stroke();} else {ctx.strokeStyle=info.stroke; ctx.globalAlpha=0.4; ctx.lineWidth=1; ctx.stroke();} ctx.globalAlpha=1; }
    for(const p of PV){ctx.beginPath(); ctx.arc(p[0],p[1],5,0,Math.PI*2); ctx.fillStyle=get('--vert'); ctx.fill();}
  }
  function tick(){draw(); requestAnimationFrame(tick);} resize(); setFace(0); syncHUD(); tick();
})();
</script>
</body>
</html>
